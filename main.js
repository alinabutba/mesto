!function(){"use strict";class e{_selectorOpenedPopup="popup_opened";_selectorPopupCloseButton=".popup__close-button";_closePopupButton=null;_popupElement=null;_handleEscClose=this._handleEscClose.bind(this);_handleOverlayClose=this._handleOverlayClose.bind(this);setEventListeners=this.setEventListeners.bind(this);constructor(e){this._popupElement=e,this._closePopupButton=this._popupElement.querySelector(this._selectorPopupCloseButton)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target===e.currentTarget&&this.close()}open(){this._popupElement.classList.add(this._selectorOpenedPopup),document.addEventListener("keyup",this._handleEscClose),this._popupElement.addEventListener("click",this._handleOverlayClose)}close(){this._popupElement.classList.remove(this._selectorOpenedPopup),document.removeEventListener("keyup",this._handleEscClose),this._popupElement.removeEventListener("click",this._handleOverlayClose)}setEventListeners(){this._closePopupButton.addEventListener("click",(()=>{this.close()}))}}class t extends e{_callbackSubmit=null;_submit=this._submit.bind(this);_submitButtonText=null;_dataConfirm={};constructor(e,t){super(e),this._submitButtonText=e.querySelector(".form-edit__save-button"),this._callbackSubmit=t}_submit(e){e.preventDefault(),this._submitButtonText.textContent="Удаление...",this._callbackSubmit()}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",this._submit)}open(e){this._dataConfirm=e,this._submitButtonText.textContent="Удалить",super.open()}close(){super.close()}}class s{_data;_template;_elementCard;_handleCardClick;_elementLike;_elementImage;_ownerId;_activeDeleteBtn;_handleDeletLike;_handleSetLike;_listLike=[];constructor(e,t,s,{handleCardClick:n,handleCardClickDelete:r,handleSetLike:i,handleDeletLike:o}){this._ownerId=e,this._data=t,this._template=s.cardTemplate,this._handleCardClick=n,this._handleCardClickDelete=r,this._handleSetLike=i,this._handleDeletLike=o}_getElementCard(){return this._template.content.querySelector(".element").cloneNode(!0)}_setDataCard(e){this._elementCard.querySelector(".element__title").textContent=e.name,this._elementCard.querySelector(".element__image").alt=this._data.name,this._elementCard.querySelector(".element__image").src=this._data.link}_setActiveElementDelete(){this._elementCard.querySelector(".element__delete").classList.add("element__delete_active")}_isOwnerCard(){return this._data.owner._id===this._ownerId}deleteCard(){this._elementCard.remove(),this._elementCard=null}_setEventListeners(){this._elementImage.addEventListener("click",(()=>{this._handleCardClick(this._data)})),this._isOwnerCard()&&(this._setActiveElementDelete(),this._activeDeleteBtn=this._elementCard.querySelector(".element__delete"),this._activeDeleteBtn.addEventListener("click",(()=>{this._handleCardClickDelete(this._data)}))),this._elementLike.addEventListener("click",(()=>{this._elementLike.classList.contains("element__like_active")?(this._handleDeletLike(),this._deleteLike(this._data)):(this._handleSetLike(),this._setLike(this._data))}))}_checkIsLike(e){return this._listLike=this._data.likes.map((e=>e._id)),!!this._listLike.some((t=>t===e))}setCountLike(e){this._elementCard.querySelector(".element__like-count").textContent=String(e.likes.length)}_setLikes(){this._checkIsLike(this._ownerId)?this._setLike(this._data):this._deleteLike(this._data)}_setLike(e){this._addLikeActive(),this.setCountLike(e)}_deleteLike(e){this._removeLikeActive(),this.setCountLike(e)}_addLikeActive(){this._elementLike.classList.add("element__like_active")}_removeLikeActive(){this._elementLike.classList.remove("element__like_active")}getCard(){return this._elementCard=this._getElementCard(),this._elementLike=this._elementCard.querySelector(".element__like"),this._elementImage=this._elementCard.querySelector(".element__image"),this._setDataCard(this._data),this._setEventListeners(),this._setLikes(),this._elementCard}}class n{_formElement=null;_formSelector=null;_inputSelector=null;_submitButtonSelector=null;_inactiveButtonClass=null;_errorClass=null;_errorTypeInvalid=null;_errorTypeValid=null;_buttonElement=null;_inputList=null;resetValidation=this.resetValidation.bind(this);constructor(e,t){this._formElement=e,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._errorClass=t.errorClass,this._errorTypeInvalid=t.errorTypeInvalid,this._errorTypeValid=t.errorTypeValid,this._buttonElement=e.querySelector(this._submitButtonSelector),this._inputList=[...this._formElement.querySelectorAll(this._inputSelector)]}_getErrorElement(e){return this._formElement.querySelector(`#${e.id}-error`)}_showInputError(e,t){const s=this._getErrorElement(e);s.textContent=t,s.classList.add(this._errorClass),e.classList.add(this._errorTypeInvalid),e.classList.remove(this._errorTypeValid)}_hideInputError(e){const t=this._getErrorElement(e);t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._errorTypeInvalid),e.classList.add(this._errorTypeValid)}setStateButton(e){e?this._buttonElement.removeAttribute("disabled",!0):this._buttonElement.setAttribute("disabled",!0)}_isValidAllInput(){return this._inputList.every((e=>e.validity.valid))}_checkInputValidity(e){if(e.validity.valid)this._hideInputError(e);else{const t=e.validationMessage;this._showInputError(e,t)}}_setListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._isValidAllInput()?this.setStateButton(!0):this.setStateButton(!1)}))}))}resetValidation(){this._inputList.forEach((e=>{const t=this._getErrorElement(e);t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._errorTypeInvalid),e.classList.remove(this._errorTypeValid)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this.setStateButton(!1)})),this._setListeners()}}class r{_renderer=null;_containerSelector=null;constructor({renderer:e},t){this._renderer=e,this._containerSelector=t}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e,t=!0){t?this._containerSelector.append(e):this._containerSelector.prepend(e)}}class i extends e{_popupElementImage=null;_popupElementImageText=null;constructor(e){super(e),this._popupElementImage=e.querySelector(".popup__picture"),this._popupElementImageText=e.querySelector(".popup__picture-text")}open(e){this._popupElementImage.src=e.link,this._popupElementImage.alt=e.name,this._popupElementImageText.textContent=e.name,super.open()}}class o extends e{_callbackSubmit=null;_callbackValidity=null;_inputListField=[];_inputsData={};_submit=this._submit.bind(this);_getInputValues=this._getInputValues.bind(this);_submitButtonText=null;constructor(e,t,s){super(e),this._submitButtonText=e.querySelector(".form-edit__save-button"),this._callbackValidity=t,this._callbackSubmit=s,this._inputListField=[...this._popupElement.querySelectorAll(".form-edit__field")]}_getInputValues(){return this._inputListField.forEach((e=>{this._inputsData[e.name]=e.value})),this._inputsData}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",this._submit)}_submit(e){e.preventDefault(),this._callbackSubmit(this._getInputValues()),this._submitButtonText.textContent="Сохранение..."}open(){this._submitButtonText.textContent="Сохранить",super.open(),this._callbackValidity.resetValidation(),this._callbackValidity.setStateButton(!1)}close(){this._popupElement.querySelector(".form-edit").reset(),super.close()}}class a{_userData={};constructor(e){this._userData=e}getUserInfo(){return{name:this._userData.name.textContent,about:this._userData.about.textContent}}setUserInfo(e){this._userData.name.textContent=e.name,this._userData.about.textContent=e.about}setUserAvatar(e){this._userData.avatar.src=e.link}}const l={formSelector:".form-edit",inputSelector:".form-edit__field",submitButtonSelector:".form-edit__save-button",inactiveButtonClass:"form-edit__save-button_inactive",errorClass:"form-edit__field-error_active",errorTypeInvalid:"form-edit__field_type_error",errorTypeValid:"form-edit__field_type_valid"},u=(document.querySelector(".popup__close-button"),document.querySelectorAll(".form-edit"),{popupEdit:document.querySelector("#popup-edit"),openButtonPopupEdit:document.querySelector(".person-card__edit-button"),buttonAddPopupEdit:document.querySelector(".add-button"),submitPersonForm:document.querySelector("#person-form"),nameInput:document.querySelector("#name-form"),jobInput:document.querySelector("#job-form")}),c={cardName:document.querySelector(".person-card__name"),cardJob:document.querySelector(".person-card__job"),avatar:document.querySelector(".person-card__avatar")},d={popupCard:document.querySelector("#popup-card"),submitCardForm:document.querySelector("#card-form"),cardTitle:document.querySelector("#title-form"),cardLink:document.querySelector("#link-form"),cardsContainerTemplate:document.querySelector(".elements"),cardTemplate:document.querySelector("#element-template"),cardCountLike:document.querySelector(".element__like-count"),cardElementLike:document.querySelector(".element__like")},_={popupImage:document.querySelector("#popup-image")},h={popupConfirm:document.querySelector("#popup-confirm"),submitCardForm:document.querySelector("#form-confirm")},p={popupAvatar:document.querySelector("#popup-avatar"),submitAvatarForm:document.querySelector("#form-avatar"),cardLink:document.querySelector("#link-form")},m=document.querySelector("#name-form"),v=document.querySelector("#job-form"),k=document.querySelector(".person-card__edit-avatar"),C=new class{_token=null;_cohort=null;_baseUrl=null;_baseUserUrl=null;constructor(e,t,s){this._token=t,this._cohort=s,this._baseUrl=e,this._baseUserUrl=this._baseUrl+this._cohort+"/"}_handlerResponse(e){return e.ok?(console.log(`Response OK-> (${e.status}) - ${e.statusText}`),e.json()):(console.log(`Bad responce -| Ошибка номер: (${e.status}) - ${e.statusText}`),Promise.reject(`Ошибка номер (${e.status}) - ${e.statusText}`))}getUser(){return fetch(`${this._baseUserUrl}users/me`,{method:"GET",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handlerResponse)}getCards(){return fetch(`${this._baseUserUrl}cards`,{method:"GET",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handlerResponse)}setUserInfo(e){return fetch(`${this._baseUserUrl}users/me`,{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then(this._handlerResponse)}setNewCard(e){return fetch(`${this._baseUserUrl}cards`,{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then(this._handlerResponse)}deleteCard(e){return console.log(`DELETING DATA:${e}`),fetch(`${this._baseUserUrl}cards/${e._id}`,{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handlerResponse)}setLike(e){return fetch(`${this._baseUserUrl}cards/likes/${e._id}`,{method:"PUT",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handlerResponse)}deleteLike(e){return fetch(`${this._baseUserUrl}cards/likes/${e._id}`,{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handlerResponse)}setUserAvatar(e){return fetch(`${this._baseUserUrl}users/me/avatar`,{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.avatar})}).then(this._handlerResponse)}}("https://mesto.nomoreparties.co/v1/","3c4415d5-c1df-4466-9c8b-f9507570a1b7","cohort-27");(()=>{C.getUser().then((t=>{console.log(`user id:${t._id}\nuser name:${t.name}\nabout:${t.about}\nuser avatar:${t.avatar}`),e.setUserInfo(t),e.setUserAvatar({link:t.avatar})})).catch((e=>console.log(e)));const e=new a({name:c.cardName,about:c.cardJob,avatar:c.avatar}),t=new n(u.popupEdit,l);t.enableValidation();const s=new o(u.popupEdit,t,(t=>{C.setUserInfo({name:t.name,about:t.job}).then((t=>{e.setUserInfo(t),s.close()})).catch((e=>{console.log(e)}))}));s.setEventListeners(),u.openButtonPopupEdit.addEventListener("click",(()=>{t.resetValidation(),m.value=e.getUserInfo().name,v.value=e.getUserInfo().about,s.open()}));const r=new n(p.popupAvatar,l);r.enableValidation();const i=new o(p.popupAvatar,r,(t=>{C.setUserAvatar({avatar:t.link}).then((t=>{e.setUserAvatar({link:t.avatar}),i.close()})).catch((e=>{console.log(e)}))}));i.setEventListeners(),k.addEventListener("click",(()=>{r.resetValidation(),i.open()}))})(),(()=>{const e=new n(d.popupCard,l);e.enableValidation();const a=new i(_.popupImage);function c(e,n,r){const i=new s(e,n,r,{handleCardClick:e=>{a.open(e)},handleCardClickDelete:()=>{const e=new t(h.popupConfirm,(()=>{C.deleteCard(n).then((t=>{i.deleteCard(),e.close()})).catch((e=>{console.log("delete error: "+e)}))}));e.setEventListeners(),e.open()},handleSetLike:()=>{C.setLike(n).then((e=>{i.setCountLike(e)})).catch((e=>{console.log(e)}))},handleDeletLike:()=>{C.deleteLike(n).then((e=>{i.setCountLike(e)})).catch((e=>{console.log(e)}))}});return i}a.setEventListeners(),Promise.all([C.getUser(),C.getCards()]).then((([t,s])=>{const n=new r({renderer:e=>{n.addItem(c(t._id,e,d).getCard(),!0)}},d.cardsContainerTemplate);n.renderItems(s);const i=new o(d.popupCard,e,(e=>{C.setNewCard(e).then((e=>{n.addItem(c(t._id,e,d).getCard(),!1)})).catch((e=>{console.log(e)})).finally(i.close())}));i.setEventListeners(),u.buttonAddPopupEdit.addEventListener("click",(()=>{i.open()}))})).catch((e=>{console.log(e)}))})()}();